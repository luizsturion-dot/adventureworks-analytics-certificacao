models:
  - name: fct_sales
    description: "The core Sales Fact table, built at the Sales Order Detail line-item granularity. This model combines order header context with line item metrics and serves as the primary source for revenue and volume analysis."
    
    columns:
      # --- PRIMARY KEY (SURROGATE KEY - SK) ---
      - name: sales_key
        description: "The primary Surrogate Key (SK) for the Fact table, generated by combining Sales Order ID and Sales Detail ID. Guarantees uniqueness for every single line item transaction."
        tests:
          - unique
          - not_null
          
      # --- FOREIGN KEYS (BUSINESS KEYS - FKs) ---
      - name: sales_order_id
        description: "Business Key (BK) of the Sales Order Header. Used for aggregating metrics at the order level."
        tests:
          - not_null
          
      - name: customer_id
        description: "Foreign Key (FK) referencing the dim_clientprofile or dim_customer dimension (Business Key)."
        tests:
          - not_null
              
      - name: product_id
        description: "Foreign Key (FK) referencing the dim_product dimension (Business Key)."
        tests:
          - not_null
              
      - name: territory_id
        description: "Foreign Key (FK) referencing the Sales Territory dimension (Business Key)."
        
      - name: shipping_id
        description: "Foreign Key (FK) referencing the dim_location dimension for the shipping address (Business Key)."

      - name: credit_card_id
        description: "Foreign Key (FK) referencing the credit card information (Business Key)."
        
      # --- DATES & HEADER ATTRIBUTES ---
      - name: orderdate
        description: "Date the order was placed. Used for linking to the dim_date dimension."
        tests:
          - not_null
          
      - name: status_description
        description: "Human-readable status of the order ('Shipped', 'Cancelled', 'In process', etc.)."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_set:
              arguments:
                value_set: ['In process', 'In Approved', 'Backordered', 'Rejected', 'Shipped', 'Cancelled']
                quote_values: true
              
      - name: freight
        description: "Header-level freight charge applied to the order."

      # --- FACTS / METRICS ---
      - name: order_quantity
        description: "Quantity of product units purchased in this line item."
        tests:
          - not_null
          - dbt_expectations.expect_column_distinct_count_to_be_greater_than:
              arguments:  
                value: 0

      - name: negotiated_price
        description: "Gross price of the line item: Order Quantity * Unit Price (before unit discount)."
        tests:
          - not_null
          
      - name: net_negotiated_price
        description: "Net price of the line item: (Order Quantity * Unit Price) * (1 - Unit Price Discount)."
        tests:
          - not_null
          
      - name: unitpricediscount
        description: "The discount rate applied to the unit price (0.0 to 1.0)."
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
                max_value: 1
              
      - name: had_discount
        description: "Boolean flag: TRUE if a discount was applied to the line item."